# Khmer ML Correction - Northflank Environment Variables
# Copy these to Northflank service configuration
# Last updated: 2025-10-15

# ========================================
# TRAINING CONFIGURATION
# ========================================

# Device Configuration
DEVICE=cuda
CUDA_VISIBLE_DEVICES=0

# Training Hyperparameters
BATCH_SIZE=64
EPOCHS=50
LEARNING_RATE=1e-4
EARLY_STOPPING=10
GRADIENT_CLIP=1.0

# ========================================
# MODEL ARCHITECTURE - HYBRID
# ========================================

# Atomic Mapper (Stage 1)
ATOMIC_EMBED_DIM=128
ATOMIC_HIDDEN_DIM=256
ATOMIC_LAYERS=3

# Context Refiner (Stage 2)
REFINER_D_MODEL=128
REFINER_NHEAD=4
REFINER_LAYERS=3
REFINER_FFN_DIM=512
REFINER_DROPOUT=0.1

# ========================================
# DATASET & PATHS
# ========================================

# Dataset
DATA_DIR=data/training_pairs_mega_331p

# Output Directory (use persistent volume mount)
OUTPUT_DIR=runs/hybrid_a100

# ========================================
# PYTORCH & CUDA OPTIMIZATION
# ========================================

# PyTorch Settings
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1
TORCH_HOME=/app/.cache/torch

# CUDA Optimization
CUDA_LAUNCH_BLOCKING=0
TORCH_CUDNN_BENCHMARK=1

# Memory Management
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512

# ========================================
# LOGGING & MONITORING (OPTIONAL)
# ========================================

# WandB Integration (uncomment if you have API key)
# WANDB_API_KEY=your_wandb_api_key_here
# WANDB_PROJECT=khmer-pdf-correction
# WANDB_ENTITY=your_wandb_username
# WANDB_RUN_NAME=hybrid_a100_run_1

# TensorBoard (optional)
# TENSORBOARD_LOG_DIR=/app/runs/tensorboard

# ========================================
# ADVANCED SETTINGS (Optional)
# ========================================

# Training Workers (DataLoader)
NUM_WORKERS=4

# Mixed Precision Training (A100 supports BF16)
USE_AMP=true
AMP_DTYPE=bfloat16

# Checkpoint Settings
SAVE_EVERY_N_EPOCHS=5
KEEP_N_CHECKPOINTS=3

# ========================================
# GPU SPECIFIC (A100 Optimization)
# ========================================

# Use Tensor Cores
NVIDIA_TF32_OVERRIDE=1

# A100 specific optimizations
NCCL_P2P_LEVEL=NVL

# ========================================
# NOTES FOR NORTHFLANK DEPLOYMENT
# ========================================

# 1. GPU Configuration:
#    - GPU: NVIDIA A100 (80GB VRAM)
#    - GPUs: 1
#    - vCPU: 12
#    - Memory: 170GB
#    - Cost: $1.76/hour
#
# 2. Expected Performance:
#    - Training time: ~45 minutes for 50 epochs
#    - Cost: ~$1.32 total
#    - Final CER: Expected <10% (vs baseline 76.49%)
#
# 3. Storage:
#    - Ephemeral: 250GB
#    - Persistent volume: /app/runs (50GB)
#
# 4. Monitoring:
#    - View logs: northflank logs ml-pdf-extract --follow
#    - Check GPU: northflank exec ml-pdf-extract -- nvidia-smi
#
# 5. After Training:
#    - Best model: /app/runs/hybrid_a100/best_model.pt
#    - Download: northflank download ml-pdf-extract:/app/runs/hybrid_a100/best_model.pt ./
